<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sky.mapper.FeeMapper">

    <!-- 分页查询支付账单记录 -->
    <select id="selectPayments" parameterType="com.sky.dto.PaymentsPageQueryDTO" resultType="com.sky.vo.PaymentVO">
        SELECT
            p.payment_id AS paymentId,
            u.username,
            u.phone_number AS phoneNumber,
            p.amount,
            p.status,
            p.payment_method AS paymentMethod,
            p.payment_time AS paymentTime
        FROM parking.payments p
        JOIN parking.users u ON p.user_id = u.user_id
        <where>
            <if test="phoneNumber != null and phoneNumber != ''">
                AND  u.phone_number = #{phoneNumber}
            </if>
            <if test="status != null and status != ''">
                AND p.status = #{status}
            </if>
        </where>
        ORDER BY paymentId ASC
    </select>

    <!-- 创建支付账单 -->
    <insert id="createPay" parameterType="com.sky.entity.Payments">
        INSERT INTO parking.payments (
        user_id,
        reservation_id,
        amount,
        status,
        payment_method
        ) VALUES (
        #{userId},
        #{reservationId},
        #{amount},
        #{status},
        #{paymentMethod}
        )

    </insert>

    <!-- 更新支付状态 -->
    <update id="updatePaymentStatus" parameterType="com.sky.entity.Payments">
        UPDATE parking.payments
        SET status = #{status}
        WHERE payment_id = #{paymentId}
    </update>
</mapper>
